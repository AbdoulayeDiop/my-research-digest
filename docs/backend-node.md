# Node.js Backend

The Node.js backend is the central API for the My Research Digest application. It is built with **Express.js** and connects to a **MongoDB** database. Its primary responsibilities are to handle user data, manage newsletters and their issues, and provide an interface for the Python backend to post generated content.

## Tech Stack

-   **Framework**: [Express.js](https://expressjs.com/)
-   **Database**: [MongoDB](https://www.mongodb.com/)
-   **ODM**: [Mongoose](https://mongoosejs.com/)
-   **Authentication**: [JWT (JSON Web Tokens)](https://jwt.io/)

## Project Structure

The backend code is located in the `backend-node/src` directory and follows a standard Model-View-Controller (MVC) pattern.

```
backend-node/src
├── controllers/    # Business logic for routes
│   ├── userController.js
│   ├── newsletterController.js
│   ├── issueController.js
│   └── paperController.js
├── middleware/     # Express middleware
│   └── authMiddleware.js
├── models/         # Mongoose database models
│   ├── User.js
│   ├── Newsletter.js
│   ├── Issue.js
│   └── Paper.js
├── routes/         # API route definitions
│   ├── users.js
│   ├── newsletters.js
│   ├── issues.js
│   └── papers.js
└── server.js       # Application entry point
```

## API Endpoints

The API is versioned under the `/api` prefix (configured in the Nginx reverse proxy). The main resources are:

-   **`/api/users`**: Handles user registration, login, and profile management.
-   **`/api/newsletters`**: Provides CRUD (Create, Read, Update, Delete) operations for newsletters.
-   **`/api/issues`**: Manages the issues of a newsletter, including fetching the latest issue and its content.
-   **`/api/papers``**: Manages the individual papers associated with an issue.

The Python backend also uses these endpoints to:
-   Fetch all newsletters to be processed.
-   Create new issues once they are generated.
-   Create new paper entries linked to the new issues.

## Database Models

The application uses Mongoose to define schemas for the data stored in MongoDB.

-   **`User`**: Stores user information, including their email, password (hashed), and a list of their newsletters.
-   **`Newsletter`**: Represents a newsletter subscription, containing its topic, the user who created it, and a list of its issues.
-   **`Issue`**: A single issue of a newsletter, containing its title, publication date, and the full content in Markdown format.
-   **`Paper`**: An academic paper included in an issue, storing its title, authors, abstract, and the analysis generated by the Python backend.

## Authentication

Authentication is handled using JSON Web Tokens (JWT).
1.  When a user logs in, the backend verifies their credentials and, if successful, returns a JWT.
2.  The frontend stores this token and includes it in the `Authorization` header of subsequent requests.
3.  The `authMiddleware.js` middleware on the backend verifies the token on protected routes, ensuring that only authenticated users can access them.
